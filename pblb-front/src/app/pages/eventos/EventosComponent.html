<div class="card">
  <p-toast></p-toast>

  <p-toolbar class="mb-6">
    <ng-template #start>
      <button pButton pRipple label="Nuevo Evento" icon="pi pi-plus"
              class="p-button-success mr-2" (click)="abrirNuevo()"></button>
    </ng-template>

    <ng-template #center>
      <p-iconfield iconPosition="left" class="ml-auto">
        <p-inputicon>
          <i class="pi pi-search"></i>
        </p-inputicon>
        <input pInputText type="text"
               (input)="dt?.filterGlobal($event.target.value, 'contains')"
               placeholder="Búsqueda por palabra"/>
      </p-iconfield>
    </ng-template>

    <ng-template #end>
      <!-- Aquí podrías añadir botones adicionales si los necesitas, como en SociosComponent -->
    </ng-template>
  </p-toolbar>

  <p-table #dt [value]="eventos" [rows]="10" [paginator]="true" [loading]="loading"
           [rowHover]="true" dataKey="uid" [globalFilterFields]="['nombreEvento', 'ubicacion']"
           currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} eventos"
           [showCurrentPageReport]="true">
    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Ubicación</th>
        <th>Coste Estimado</th>
        <th>Participantes</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-evento>
      <tr [pSelectableRow]="evento">
        <td>{{ evento.nombreEvento }}</td>
        <td>{{ evento.fechaEvento | date:'dd/MM/yyyy' }}</td>
        <td>{{ evento.ubicacion }}</td>
        <td>{{ evento.costeTotalEstimado | currency:'EUR' }}</td>
        <td>{{ evento.participantes }}</td>
        <td>
          <button pButton pRipple icon="pi pi-pencil"
                  class="p-button-rounded p-button-success mr-2"
                  (click)="editarEvento(evento)"></button>
          <button pButton pRipple icon="pi pi-trash"
                  class="p-button-rounded p-button-danger"
                  (click)="eliminarEvento(evento)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="eventoDialog" [style]="{ width: '650px' }" header="Detalles del Evento"
          [modal]="true">
  <ng-template #content>
    <div class="flex flex-col gap-6 w-full">
      <!-- Información Básica -->
      <div class="flex flex-col gap-6">
        <span class="font-semibold text-lg">Información Básica</span>
        <div class="flex flex-col sm:flex-row sm:items-center gap-6">
          <div class="flex-auto">
            <label for="nombreEvento" class="block font-semibold mb-2">Nombre del Evento*</label>
            <input type="text" pInputText id="nombreEvento"
                   [(ngModel)]="evento.nombreEvento"
                   class="w-full" required/>
            <!-- Aquí podrías añadir validación si es necesario, similar a SociosComponent -->
          </div>
          <div class="flex-auto">
            <label for="fechaEvento" class="block font-semibold mb-2">Fecha del Evento*</label>
            <p-datepicker id="fechaEvento" [(ngModel)]="evento.fechaEvento"
                          class="w-full" [dateFormat]="'dd/mm/yy'"
                          [showIcon]="true" required></p-datepicker>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-center gap-6">
          <div class="flex-auto">
            <label for="ubicacion" class="block font-semibold mb-2">Ubicación</label>
            <input type="text" pInputText id="ubicacion" [(ngModel)]="evento.ubicacion"
                   class="w-full"/>
          </div>
          <div class="flex-auto">
            <label for="numeroPlazas" class="block font-semibold mb-2">Número de Plazas</label>
            <p-inputNumber id="numeroPlazas" [(ngModel)]="evento.numeroPlazas"
                           class="w-full" [showButtons]="true" [min]="0"></p-inputNumber>
          </div>
        </div>
      </div>

      <!-- Costes -->
      <div class="flex flex-col gap-6">
        <span class="font-semibold text-lg">Costes</span>
        <div class="flex flex-col sm:flex-row sm:items-center gap-6">
          <div class="flex-auto">
            <label for="costeTotalEstimado" class="block font-semibold mb-2">Coste Estimado</label>
            <p-inputNumber id="costeTotalEstimado" [(ngModel)]="evento.costeTotalEstimado"
                           mode="currency" currency="EUR" class="w-full"></p-inputNumber>
          </div>
          <div class="flex-auto">
            <label for="costeTotalReal" class="block font-semibold mb-2">Coste Real</label>
            <p-inputNumber id="costeTotalReal" [(ngModel)]="evento.costeTotalReal"
                           mode="currency" currency="EUR" class="w-full"></p-inputNumber>
          </div>
        </div>
      </div>

      <!-- Descripción -->
      <div class="flex-auto">
        <label for="descripcion" class="block font-semibold mb-2">Descripción</label>
        <textarea pTextarea id="descripcion" [(ngModel)]="evento.descripcion" rows="4"
                  class="w-full" [autoResize]="true"></textarea>
      </div>
    </div>
  </ng-template>

  <ng-template #footer>
    <p-button label="Cancelar" icon="pi pi-times" (onClick)="eventoDialog = false"
              [text]="true"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="guardarEvento()"></p-button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>