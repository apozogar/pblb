# --- Etapa 1: Construcción (Build Stage) ---
# Usamos una imagen de Node para construir la aplicación Angular.
# Usamos la versión de tu pom.xml para mantener la consistencia.
FROM node:22.12.0-alpine AS build

# Establecemos el directorio de trabajo.
WORKDIR /app

# Copiamos los archivos de definición de dependencias.
COPY frontend/package.json frontend/package-lock.json* ./

# Instalamos las dependencias de npm.
RUN npm install

# Copiamos todo el código fuente del frontend.
COPY frontend/ ./

# Construimos la aplicación para producción.
RUN npm run build

# --- Etapa 2: Servidor (Serve Stage) ---
# Usamos una imagen ligera de Nginx para servir los archivos estáticos.
FROM nginx:1.27-alpine

# Copiamos los archivos de la aplicación construida desde la etapa anterior
# a la carpeta que Nginx usa para servir contenido web.
COPY --from=build /app/dist/browser /usr/share/nginx/html

# Copiamos una configuración personalizada de Nginx para que funcione con Angular Router.
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Exponemos el puerto 80 (puerto estándar de Nginx).
EXPOSE 80